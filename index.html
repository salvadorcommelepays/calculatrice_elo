<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Calculatrice Elo FIDE</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background:#eef2f7;
        margin:0;
    }

    .container {
        max-width:1200px;
        margin:40px auto;
        background:white;
        padding:30px;
        border-radius:12px;
        box-shadow:0 0 20px rgba(0,0,0,0.1);
    }

    h1 {
        text-align:center;
        margin-bottom:25px;
        color:#333;
        font-size:32px;
    }

    .section {
        padding:15px;
        background:#f8fafc;
        border-radius:8px;
        margin-bottom:20px;
    }

    label {
        display:block;
        margin-top:10px;
        font-weight:bold;
    }

    input[type="checkbox"] { margin-right:8px; }

    input[type="number"], input[type="text"], select {
        width:100%;
        padding:8px;
        border-radius:6px;
        border:1px solid #ccc;
        margin-top:5px;
        font-size:16px;
    }

    .coeff-box {
        display:flex;
        gap:15px;
        margin-top:15px;
    }

    .coeff-card {
        flex:1;
        background:#e7f3ff;
        padding:15px;
        border-left:5px solid #1976d2;
        border-radius:8px;
        text-align:center;
        font-size:18px;
    }

    table {
        width:100%;
        margin-top:20px;
        border-collapse:collapse;
    }

    th {
        background:#1976d2;
        color:white;
        padding:10px;
    }

    td {
        padding:10px;
        border-bottom:1px solid #ddd;
        text-align:center;
    }

    tr:nth-child(even) { background:#f4f6f8; }

    button {
        padding:10px 15px;
        background:#1976d2;
        color:white;
        border:none;
        border-radius:6px;
        cursor:pointer;
        font-size:16px;
        margin-right:10px;
    }

    button:hover { background:#0f5cad; }

    .result-box {
        margin-top:20px;
        padding:15px;
        background:#e7f3ff;
        border-left:5px solid #1976d2;
        border-radius:8px;
        font-size:20px;
    }

    .elo-green { color:green; font-weight:bold; }
    .elo-red { color:red; font-weight:bold; }
</style>
</head>

<body>
<div class="container">

    <h1>Calculatrice Elo FIDE Avanc√©e</h1>

    <!-- üìå √âLO PAR CADENCE -->
    <div class="section">
        <h3>√âlo par cadence</h3>
        <div id="eloCadencesDisplay">
            Classique : - <br>
            Rapide : - <br>
            Blitz : -
        </div>
    </div>

    <!-- OPTIONS DU JOUEUR -->
    <div class="section">
        <label>Elo actuel :</label>
        <input type="number" id="eloInitial">

        <label><input type="checkbox" id="mineur"> Je suis mineur</label>

        <label>J'ai d√©j√† √©t√© 2400+ dans :</label>
        <label><input type="checkbox" class="is2400" value="classique"> Classique</label>
        <label><input type="checkbox" class="is2400" value="rapide"> Rapide</label>
        <label><input type="checkbox" class="is2400" value="blitz"> Blitz</label>

        <div class="coeff-box">
            <div class="coeff-card" id="kClassiqueBox">K Classique : -</div>
            <div class="coeff-card" id="kRapideBox">K Rapide : -</div>
            <div class="coeff-card" id="kBlitzBox">K Blitz : -</div>
        </div>
    </div>

    <!-- R√âSUM√â DES PARTIES -->
    <div class="section">
        <h3>R√©sum√© des parties :</h3>
        <div id="resumeCadences">
            Classique : 0 partie(s) <br>
            Rapide : 0 partie(s) <br>
            Blitz : 0 partie(s)
        </div>
    </div>

    <!-- TABLEAU DES PARTIES -->
    <table id="tableParties">
        <thead>
            <tr>
                <th>#</th>
                <th>Elo Adv</th>
                <th>R√©sultat</th>
                <th>Cadence</th>
                <th>Note</th>
                <th>E (proba)</th>
                <th>K</th>
                <th>Œî Elo</th>
                <th>Elo apr√®s</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <button onclick="addRow()">Ajouter une partie</button>
    <button onclick="calculate()">Recalculer</button>
    <button onclick="resetTable()">R√©initialiser</button>

    <div class="result-box" id="resultFinal"></div>

</div>

<script>
let count = 0;

// üî¢ Mise √† jour du r√©sum√© des cadences
function updateCadenceSummary() {
    let rows = document.querySelectorAll("#tableParties tbody tr");
    let counts = { classique:0, rapide:0, blitz:0 };
    rows.forEach(r => counts[r.querySelector(".cadence").value]++);
    document.getElementById("resumeCadences").innerHTML =
        `Classique : ${counts.classique} partie(s) <br>
         Rapide : ${counts.rapide} partie(s) <br>
         Blitz : ${counts.blitz} partie(s)`;
}

// üî¢ Mise √† jour des √âlos par cadence
function updateEloCadences() {
    let eloInitial = parseInt(document.getElementById("eloInitial").value);
    if (isNaN(eloInitial)) return;

    let rows = document.querySelectorAll("#tableParties tbody tr");
    let total = { classique:0, rapide:0, blitz:0 };

    rows.forEach(r => {
        let cad = r.querySelector(".cadence").value;
        let delta = parseInt(r.querySelector(".delta").innerText);
        if (!isNaN(delta)) total[cad] += delta;
    });

    document.getElementById("eloCadencesDisplay").innerHTML =
        `Classique : ${eloInitial + total.classique} <br>
         Rapide : ${eloInitial + total.rapide} <br>
         Blitz : ${eloInitial + total.blitz}`;
}

// ‚ûï Ajouter une ligne
function addRow() {
    count++;
    let tbody = document.querySelector("#tableParties tbody");
    let tr = document.createElement("tr");

    tr.innerHTML = `
        <td>${count}</td>
        <td><input type="number" class="eloAdv"></td>
        <td><select class="resultat"><option value="1">Victoire</option><option value="0.5">Nul</option><option value="0">D√©faite</option></select></td>
        <td><select class="cadence"><option value="classique">Classique</option><option value="rapide">Rapide</option><option value="blitz">Blitz</option></select></td>
        <td><input type="text" class="note"></td>
        <td class="E"></td>
        <td class="K"></td>
        <td class="delta"></td>
        <td class="eloApres"></td>
    `;

    tbody.appendChild(tr);

    tr.querySelector(".cadence").addEventListener("change", () => {
        updateCadenceSummary();
        updateEloCadences();
    });

    updateCadenceSummary();
    updateEloCadences();
}

// üìò Fonction K FIDE
function computeK(cadence, nbCadence, isMineur, is2400List) {
    if (is2400List.includes(cadence)) return 10;
    let baseK = isMineur ? 40 : 20;
    if (nbCadence === 0) return baseK;
    let kEff = Math.floor(700 / nbCadence);
    return Math.max(10, Math.min(baseK, kEff));
}

// üßÆ Recalculer
function calculate() {
    let eloInitial = parseInt(document.getElementById("eloInitial").value);
    let elo = eloInitial;

    if (isNaN(elo)) return alert("Entrez un Elo initial.");

    let isMineur = document.getElementById("mineur").checked;
    let is2400List = Array.from(document.querySelectorAll(".is2400:checked")).map(c => c.value);

    let rows = document.querySelectorAll("#tableParties tbody tr");
    let countCad = { classique:0, rapide:0, blitz:0 };

    rows.forEach(r => countCad[r.querySelector(".cadence").value]++);

    let Kclassique = computeK("classique", countCad.classique, isMineur, is2400List);
    let Krapide    = computeK("rapide", countCad.rapide, isMineur, is2400List);
    let Kblitz     = computeK("blitz", countCad.blitz, isMineur, is2400List);

    document.getElementById("kClassiqueBox").innerText = "K Classique : " + Kclassique;
    document.getElementById("kRapideBox").innerText    = "K Rapide : " + Krapide;
    document.getElementById("kBlitzBox").innerText     = "K Blitz : " + Kblitz;

    let totalDelta = 0;

    rows.forEach(tr => {
        let adv = parseInt(tr.querySelector(".eloAdv").value);
        if (isNaN(adv)) return;

        let S = parseFloat(tr.querySelector(".resultat").value);
        let cad = tr.querySelector(".cadence").value;

        let E = 1 / (1 + Math.pow(10, (adv - elo) / 400));
        tr.querySelector(".E").innerText = E.toFixed(3);

        let K = (cad === "classique" ? Kclassique : cad === "rapide" ? Krapide : Kblitz);
        tr.querySelector(".K").innerText = K;

        let delta = Math.round(K * (S - E));
        tr.querySelector(".delta").innerText = delta;

        elo += delta;
        tr.querySelector(".eloApres").innerText = elo;

        totalDelta += delta;
    });

    // üî• r√©sultat final avec couleur
    let colorClass = elo > eloInitial ? "elo-green" : "elo-red";

    document.getElementById("resultFinal").innerHTML =
        `<b>Elo final :</b> <span class="${colorClass}">${elo}</span><br>
         <b>Total Œî Elo :</b> ${totalDelta}`;

    updateEloCadences();
}

// üîÅ R√©initialiser
function resetTable() {
    document.querySelector("#tableParties tbody").innerHTML = "";
    count = 0;
    document.getElementById("resultFinal").innerHTML = "";
    updateCadenceSummary();
    updateEloCadences();
}
</script>

</body>
</html>
