<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Calculatrice Elo FIDE Avancée</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background:#eef2f7;
        margin:0;
    }

    .container {
        max-width:1200px;
        margin:40px auto;
        background:white;
        padding:30px;
        border-radius:12px;
        box-shadow:0 0 20px rgba(0,0,0,0.1);
    }

    h1 {
        text-align:center;
        margin-bottom:25px;
        color:#333;
        font-size:32px;
    }

    .section {
        padding:15px;
        background:#f8fafc;
        border-radius:8px;
        margin-bottom:20px;
    }

    label {
        display:block;
        margin-top:10px;
        font-weight:bold;
    }

    input[type="checkbox"] {
        margin-right:8px;
    }

    input[type="number"], input[type="text"], select {
        width:100%;
        padding:8px;
        border-radius:6px;
        border:1px solid #ccc;
        margin-top:5px;
        font-size:16px;
    }

    .coeff-box {
        display:flex;
        gap:15px;
        margin-top:15px;
    }

    .coeff-card {
        flex:1;
        background:#e7f3ff;
        padding:15px;
        border-left:5px solid #1976d2;
        border-radius:8px;
        text-align:center;
        font-size:18px;
    }

    table {
        width:100%;
        margin-top:20px;
        border-collapse:collapse;
    }

    th {
        background:#19776d2;
        color:white;
        padding:10px;
    }

    td {
        padding:10px;
        border-bottom:1px solid #ddd;
        text-align:center;
    }

    tr:nth-child(even) {
        background:#f4f6f8;
    }

    button {
        padding:10px 15px;
        background:#1976d2;
        color:white;
        border:none;
        border-radius:6px;
        cursor:pointer;
        font-size:16px;
        margin-right:10px;
    }

    button:hover {
        background:#0f5cad;
    }

    .result-box {
        margin-top:20px;
        padding:15px;
        background:#e7f3ff;
        border-left:5px solid #1976d2;
        border-radius:8px;
        font-size:20px;
    }
</style>
</head>

<body>
<div class="container">

    <h1>Calculatrice Elo FIDE Avancée</h1>

    <!-- OPTIONS DU JOUEUR -->
    <div class="section">
        <label>Elo actuel :</label>
        <input type="number" id="eloInitial">

        <label><input type="checkbox" id="mineur"> Je suis mineur</label>

        <label>J'ai déjà été 2400+ dans cette/ces cadence(s) :</label>
        <select id="cadence2400" multiple size="3">
            <option value="classique">Classique</option>
            <option value="rapide">Rapide</option>
            <option value="blitz">Blitz</option>
        </select>

        <div class="coeff-box">
            <div class="coeff-card" id="kClassiqueBox">K Classique : -</div>
            <div class="coeff-card" id="kRapideBox">K Rapide : -</div>
            <div class="coeff-card" id="kBlitzBox">K Blitz : -</div>
        </div>
    </div>
<div class="section" style="margin-bottom:10px;">
    <h3>Résumé des parties :</h3>
    <div id="resumeCadences">
        Classique : 0 partie(s) <br>
        Rapide : 0 partie(s) <br>
        Blitz : 0 partie(s)
    </div>
</div>

    <!-- TABLEAU DES PARTIES -->
    <table id="tableParties">
        <thead>
            <tr>
                <th>#</th>
                <th>Elo Adv</th>
                <th>Résultat</th>
                <th>Cadence</th>
                <th>Note</th>
                <th>E (proba)</th>
                <th>K</th>
                <th>Δ Elo</th>
                <th>Elo après</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <button onclick="addRow()">Ajouter une partie</button>
    <button onclick="calculate()">Recalculer</button>
    <button onclick="resetTable()">Réinitialiser</button>

    <div class="result-box" id="resultFinal"></div>

</div>

<script>
let count = 0;

// Ajouter une ligne
    function updateCadenceSummary() {
    let rows = document.querySelectorAll("#tableParties tbody tr");

    let counts = { classique:0, rapide:0, blitz:0 };

    rows.forEach(r => {
        let cad = r.querySelector(".cadence").value;
        counts[cad]++;
    });

    document.getElementById("resumeCadences").innerHTML = `
        Classique : ${counts.classique} partie(s) <br>
        Rapide : ${counts.rapide} partie(s) <br>
        Blitz : ${counts.blitz} partie(s)
    `;
}
function addRow() {
    count++;
    let tbody = document.querySelector("#tableParties tbody");
    let tr = document.createElement("tr");
    tr.innerHTML = `
        <td>${count}</td>
        <td><input type="number" class="eloAdv"></td>
        <td>
            <select class="resultat">
                <option value="1">Victoire</option>
                <option value="0.5">Nul</option>
                <option value="0">Défaite</option>
            </select>
        </td>
        <td>
            <select class="cadence">
                <option value="classique">Classique</option>
                <option value="rapide">Rapide</option>
                <option value="blitz">Blitz</option>
            </select>
        </td>
        <td><input type="text" class="note"></td>
        <td class="E"></td>
        <td class="K"></td>
        <td class="delta"></td>
        <td class="eloApres"></td>
    `;
    tbody.appendChild(tr);
updateCadenceSummary();
    // Mise à jour automatique si la cadence change dans une ligne
tr.querySelector(".cadence").addEventListener("change", updateCadenceSummary);
}

    // Fonction de calcul du K d'une cadence
function computeK(cadence, nbCadence, isMineur, is2400List) {

    // 2400+ dans cette cadence → K=10
    if (is2400List.includes(cadence)) return 10;

    // Base K
    let baseK = isMineur ? 40 : 20;

    if (nbCadence === 0) return baseK;

    // Dégressivité FIDE : nb × K ≤ 700
    let kEff = Math.floor(700 / nbCadence);

    // K = min(baseK, kEff), mais jamais < 10
    return Math.max(10, Math.min(baseK, kEff));
}

function calculate() {
    let elo = parseInt(document.getElementById("eloInitial").value);
    if (isNaN(elo)) {
        alert("Entrez un Elo initial.");
        return;
    }

    let isMineur = document.getElementById("mineur").checked;

    // Cadences où le joueur a été 2400+
    let is2400List = Array.from(document.getElementById("cadence2400").selectedOptions).map(o => o.value);

    // Tableaux
    let rows = document.querySelectorAll("#tableParties tbody tr");

    // Compte des parties par cadence
    let countCad = {classique:0, rapide:0, blitz:0};
    rows.forEach(r => {
        let cad = r.querySelector(".cadence").value;
        countCad[cad]++;
    });

    // Calcul des K par cadence
    let Kclassique = computeK("classique", countCad.classique, isMineur, is2400List);
    let Krapide    = computeK("rapide",    countCad.rapide,    isMineur, is2400List);
    let Kblitz     = computeK("blitz",     countCad.blitz,     isMineur, is2400List);

    // Affichage des blocs K
    document.getElementById("kClassiqueBox").innerHTML = "K Classique : " + Kclassique;
    document.getElementById("kRapideBox").innerHTML    = "K Rapide : " + Krapide;
    document.getElementById("kBlitzBox").innerHTML     = "K Blitz : " + Kblitz;

    // Calcul partie par partie
    let totalDelta = 0;

    rows.forEach((tr, i) => {
        let adv = parseInt(tr.querySelector(".eloAdv").value);
        let S = parseFloat(tr.querySelector(".resultat").value);
        let cad = tr.querySelector(".cadence").value;

        if (isNaN(adv)) return;

        // Probabilité attendue
        let E = 1 / (1 + Math.pow(10, (adv - elo) / 400));
        tr.querySelector(".E").innerText = E.toFixed(3);

        // Sélection du K
        let K = cad === "classique" ? Kclassique :
                cad === "rapide" ? Krapide :
                Kblitz;

        tr.querySelector(".K").innerText = K;

        // Variation
        let delta = Math.round(K * (S - E));
        tr.querySelector(".delta").innerText = delta;

        // Elo après
        elo += delta;
        tr.querySelector(".eloApres").innerText = elo;

        totalDelta += delta;
    });

    document.getElementById("resultFinal").innerHTML =
        `<b>Elo final :</b> ${elo} <br><b>Total Δ Elo :</b> ${totalDelta}`;
}

// Réinitialiser
function resetTable() {
    document.querySelector("#tableParties tbody").innerHTML = "";
    count = 0;
    document.getElementById("resultFinal").innerHTML = "";
    updateCadenceSummary(); // ← ajout
}

</script>

</body>
</html>

